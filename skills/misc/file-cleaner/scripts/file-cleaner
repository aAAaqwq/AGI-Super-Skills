#!/bin/bash
# æ–‡ä»¶æ¸…ç†å·¥å…· - ä¸»å¯åŠ¨è„šæœ¬

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

case "$1" in
    # æ‰«æå¤§æ–‡ä»¶
    large)
        shift
        python3 "$SCRIPT_DIR/scripts/find_large_files.py" "$@"
        ;;

    # æ‰«æåƒåœ¾æ–‡ä»¶
    garbage)
        shift
        python3 "$SCRIPT_DIR/scripts/find_garbage.py" "$@"
        ;;

    # äº¤äº’å¼æ¸…ç†
    clean)
        shift
        python3 "$SCRIPT_DIR/scripts/clean_interactive.py" "$@"
        ;;

    # å¿«é€Ÿæ‰«æï¼ˆå¤§æ–‡ä»¶ + åƒåœ¾æ–‡ä»¶ï¼‰
    quick)
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo("â•‘                   å¿«é€Ÿæ–‡ä»¶æ‰«æ                                â•‘")
        echo("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
        echo()

        echo "1. æ‰«æå¤§æ–‡ä»¶ï¼ˆ>10MBï¼‰"
        python3 "$SCRIPT_DIR/scripts/find_large_files.py" --show 10
        echo()

        echo "2. æ‰«æåƒåœ¾æ–‡ä»¶"
        python3 "$SCRIPT_DIR/scripts/find_garbage.py" --show 5
        echo()

        echo "ğŸ’¡ è¦æ¸…ç†æ–‡ä»¶ï¼Œä½¿ç”¨ï¼š"
        echo("  file-cleaner clean <scan_result.json>")
        ;;

    # å¸®åŠ©
    help|--help|-h)
        cat << 'EOF'
æ–‡ä»¶æ¸…ç†å·¥å…· - æ‰«æå’Œæ¸…ç†å¤§æ–‡ä»¶ã€åƒåœ¾æ–‡ä»¶

ç”¨æ³•:
  file-cleaner <command> [options]

å‘½ä»¤:
  large <directory> [options]      æ‰«æå¤§æ–‡ä»¶
  garbage <directory> [options]     æ‰«æåƒåœ¾æ–‡ä»¶
  clean <scan_result.json>         äº¤äº’å¼æ¸…ç†
  quick                          å¿«é€Ÿæ‰«æï¼ˆå¤§æ–‡ä»¶ + åƒåœ¾ï¼‰

é€‰é¡¹:
  large å‘½ä»¤:
    --min-size <MB>             æœ€å°æ–‡ä»¶å¤§å°ï¼ˆé»˜è®¤: 10ï¼‰
    --max-results <N>            æœ€å¤§ç»“æœæ•°ï¼ˆé»˜è®¤: 100ï¼‰
    --show <N>                   æ˜¾ç¤ºçš„æ–‡ä»¶æ•°ï¼ˆé»˜è®¤: 20ï¼‰
    --export <path>               å¯¼å‡ºåˆ° JSON

  garbage å‘½ä»¤:
    --categories <cat1,cat2>     æŒ‡å®šæ‰«æç±»åˆ«
    --show <N>                   æ¯ä¸ªç±»åˆ«æ˜¾ç¤ºçš„æ–‡ä»¶æ•°ï¼ˆé»˜è®¤: 10ï¼‰
    --export <path>               å¯¼å‡ºåˆ° JSON
    --script <path>              ç”Ÿæˆæ¸…ç†è„šæœ¬

  clean å‘½ä»¤:
    --type <garbage|large>       æ‰«æç»“æœç±»å‹ï¼ˆé»˜è®¤: garbageï¼‰
    --dry-run                     é¢„æ¼”æ¨¡å¼ï¼ˆä¸å®é™…åˆ é™¤ï¼‰

ç¤ºä¾‹:
  # æ‰«æå¤§æ–‡ä»¶
  file-cleaner large ~

  # æ‰«æå¤§äº 50MB çš„æ–‡ä»¶
  file-cleaner large ~ --min-size 50

  # æ‰«æåƒåœ¾æ–‡ä»¶
  file-cleaner garbage ~

  # åªæ‰«æç¼“å­˜æ–‡ä»¶
  file-cleaner garbage ~ --categories cache_files temp_files

  # å¯¼å‡ºæ‰«æç»“æœ
  file-cleaner garbage ~ --export garbage_scan.json

  # äº¤äº’å¼æ¸…ç†
  file-cleaner clean garbage_scan.json

  # é¢„æ¼”æ¸…ç†ï¼ˆä¸å®é™…åˆ é™¤ï¼‰
  file-cleaner clean garbage_scan.json --dry-run

  # å¿«é€Ÿæ‰«æ
  file-cleaner quick

åƒåœ¾æ–‡ä»¶ç±»åˆ«:
  temp_files      - ä¸´æ—¶æ–‡ä»¶
  cache_files     - ç¼“å­˜æ–‡ä»¶
  log_files       - æ—¥å¿—æ–‡ä»¶
  backup_files    - å¤‡ä»½æ–‡ä»¶
  build_artifacts - æ„å»ºäº§ç‰©
  editor_temp    - ç¼–è¾‘å™¨ä¸´æ—¶æ–‡ä»¶
  download_temp   - ä¸‹è½½ä¸´æ—¶æ–‡ä»¶

å®‰å…¨æç¤º:
  â€¢ æŸ¥çœ‹æ–‡ä»¶å†…å®¹å†åˆ é™¤
  â€¢ å…ˆç”¨ --dry-run é¢„æ¼”
  â€¢ æ—¥å¿—æ–‡ä»¶å¯èƒ½éœ€è¦ä¿ç•™
  â€¢ å¤‡ä»½é‡è¦æ–‡ä»¶

EOF
        ;;

    *)
        echo "æ–‡ä»¶æ¸…ç†å·¥å…·"
        echo ""
        echo "ä½¿ç”¨ 'file-cleaner help' æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤"
        echo ""
        echo "å¿«é€Ÿå¼€å§‹:"
        echo "  file-cleaner large ~          # æ‰«æå¤§æ–‡ä»¶"
        echo "  file-cleaner garbage ~         # æ‰«æåƒåœ¾æ–‡ä»¶"
        echo "  file-cleaner quick              # å¿«é€Ÿæ‰«æ"
        echo "  file-cleaner clean results.json  # äº¤äº’å¼æ¸…ç†"
        ;;
esac
